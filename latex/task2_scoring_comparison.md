# Task 2: 计分方法比较分析

## 1. 问题理解

### 1.1 题目背景

《与星共舞》在其34季历史中使用过两种不同的计分方法来决定选手去留：

| 计分方法 | 使用季数 | 核心思想 |
|----------|----------|----------|
| 排名法 (Rank-Based) | Season 1-2, 28-34 | 将评委分数和观众投票分别转换为排名后相加 |
| 百分比法 (Percentage-Based) | Season 3-27 | 将评委分数和观众投票分别转换为百分比后相加 |

### 1.2 核心问题

**Task 2 要求分析这两种计分方法的差异及其影响：**

1. 两种方法在决定淘汰人选时有何不同？
2. 哪种方法更"公平"或更能反映观众意愿？
3. 评委分数与观众投票的相对权重如何变化？
4. 边界情况下两种方法的敏感性如何？

### 1.3 分析目标

- **量化差异**：计算两种方法产生不同结果的频率
- **识别偏向性**：分析哪种方法更偏向评委/观众
- **敏感性分析**：评估两种方法对边际变化的响应
- **反事实推断**：如果使用另一种方法，结果会如何变化

---

## 2. 计分规则详解

### 2.1 排名法 (Season 1-2, 28-34)

#### 数学表述

设第 $w$ 周有 $n$ 位选手参赛，选手 $i$ 的评委总分为 $S_i$，观众投票份额为 $V_i$。

**步骤 1：计算评委分数排名**
$$
R_i^{(S)} = \text{rank}(-S_i) \quad \text{(分数越高排名越小)}
$$

**步骤 2：计算观众投票排名**
$$
R_i^{(V)} = \text{rank}(-V_i) \quad \text{(投票越高排名越小)}
$$

**步骤 3：计算综合排名值**
$$
C_i^{\text{rank}} = R_i^{(S)} + R_i^{(V)}
$$

**淘汰规则**：综合排名值最大的选手被淘汰。

$$
\text{Eliminated} = \arg\max_i C_i^{\text{rank}}
$$

#### 特点

| 特性 | 说明 |
|------|------|
| 权重固定 | 评委和观众各占 50%（以排名计） |
| 对极端值不敏感 | 分数差距大小不影响排名 |
| 离散性 | 只有 $n$ 种可能的排名值 |
| 公平性 | 两个来源贡献相等 |

#### 示例

| 选手 | 评委分 | 投票份额 | 评委排名 | 投票排名 | 综合值 | 结果 |
|------|--------|----------|----------|----------|--------|------|
| A | 28 | 0.35 | 1 | 2 | 3 | 安全 |
| B | 25 | 0.40 | 2 | 1 | 3 | 安全 |
| C | 20 | 0.15 | 3 | 4 | 7 | **淘汰** |
| D | 18 | 0.10 | 4 | 5 | 9 | 安全* |

*注：C 虽然综合值更小，但按规则 D 应被淘汰（综合值9 > 7）

### 2.2 百分比法 (Season 3-27)

#### 数学表述

**步骤 1：计算评委分数百分比**
$$
P_i^{(S)} = \frac{S_i}{\sum_{j=1}^{n} S_j}
$$

**步骤 2：计算观众投票百分比**
$$
P_i^{(V)} = \frac{V_i}{\sum_{j=1}^{n} V_j} = V_i \quad \text{(假设投票份额已归一化)}
$$

**步骤 3：计算综合百分比**
$$
C_i^{\text{pct}} = P_i^{(S)} + P_i^{(V)}
$$

**淘汰规则**：综合百分比最低的选手被淘汰。

$$
\text{Eliminated} = \arg\min_i C_i^{\text{pct}}
$$

#### 特点

| 特性 | 说明 |
|------|------|
| 权重动态 | 取决于分数分布的离散程度 |
| 对极端值敏感 | 分数差距直接影响结果 |
| 连续性 | 可以产生任意精度的差异 |
| 可能不公平 | 分数离散时评委权重更大 |

#### 示例

| 选手 | 评委分 | 投票份额 | 评委% | 投票% | 综合% | 结果 |
|------|--------|----------|-------|-------|-------|------|
| A | 28 | 0.35 | 0.308 | 0.35 | 0.658 | 安全 |
| B | 25 | 0.40 | 0.275 | 0.40 | 0.675 | **第一** |
| C | 20 | 0.15 | 0.220 | 0.15 | 0.370 | **淘汰** |
| D | 18 | 0.10 | 0.198 | 0.10 | 0.298 | 安全* |

*注：D 的综合百分比最低（0.298 < 0.370），应被淘汰

### 2.3 关键差异

| 维度 | 排名法 | 百分比法 |
|------|--------|----------|
| **权重分配** | 固定 50%-50% | 动态（取决于分布） |
| **敏感性** | 低（只看相对顺序） | 高（看绝对差距） |
| **边际影响** | 阶跃函数（跨越名次时突变） | 连续函数 |
| **评委优势情况** | 评委差距大时优势小 | 评委差距大时优势大 |
| **抗极端值** | 强 | 弱 |
| **计算复杂度** | 简单 | 简单 |

---

## 3. 分析方法论

### 3.1 反事实模拟

**核心思想**：对每个季/周的历史数据，用另一种方法重新计算，观察结果是否改变。

#### 算法流程

```
For each season s:
    actual_method = get_scoring_method(s)  # rank 或 percent
    For each week w in season s:
        1. 获取评委分数 S 和估计投票份额 V
        2. 用 actual_method 计算淘汰结果 E_actual
        3. 用 counterfactual_method 计算淘汰结果 E_cf
        4. 记录 (s, w, E_actual, E_cf, is_same)
```

#### 输出指标

| 指标 | 定义 | 说明 |
|------|------|------|
| 淘汰翻转率 | 使用另一方法后淘汰者改变的比例 | 直接衡量方法差异 |
| 排名变化 | 各选手在两种方法下的排名差异 | 衡量整体影响 |
| 边界周数 | 两种方法淘汰者不同且差距 < 阈值的周数 | 识别敏感边界 |

### 3.2 统计比较

#### Kendall's τ（肯德尔等级相关系数）

衡量两种方法产生的排名的一致性：

$$
\tau = \frac{C - D}{\binom{n}{2}}
$$

其中 $C$ 是两种排名中一致的配对数，$D$ 是不一致的配对数。

- $\tau = 1$：完全一致
- $\tau = 0$：无相关
- $\tau = -1$：完全相反

#### Spearman's ρ（斯皮尔曼等级相关系数）

$$
\rho = 1 - \frac{6\sum d_i^2}{n(n^2-1)}
$$

其中 $d_i$ 是选手 $i$ 在两种方法下的排名差。

### 3.3 权重分解

**问题**：两种方法下，评委分数和观众投票的实际贡献比例是多少？

#### 定义有效权重

对于选手 $i$，其在最终淘汰决定中的"危险程度"可分解为：

$$
\text{Risk}_i = \alpha \cdot f(S_i) + (1-\alpha) \cdot g(V_i)
$$

其中 $\alpha$ 是评委的有效权重。

#### 排名法的权重

在排名法中，权重固定为 0.5：

$$
\alpha^{\text{rank}} = 0.5
$$

#### 百分比法的权重

在百分比法中，权重取决于分数分布：

$$
\alpha^{\text{pct}} = \frac{\text{Var}(P^{(S)})}{\text{Var}(P^{(S)}) + \text{Var}(P^{(V)})}
$$

当评委分数离散程度更大时，$\alpha^{\text{pct}} > 0.5$。

### 3.4 边际影响分析

**问题**：增加1%的投票份额，对综合得分/排名的影响有多大？

#### 排名法

$$
\frac{\partial C_i^{\text{rank}}}{\partial V_i} =
\begin{cases}
-1 & \text{if 跨越了名次边界} \\
0 & \text{otherwise}
\end{cases}
$$

边际影响是阶跃函数。

#### 百分比法

$$
\frac{\partial C_i^{\text{pct}}}{\partial V_i} = 1 - V_i \approx 1
$$

边际影响几乎是常数。

---

## 4. 评估指标

### 4.1 核心指标

| 指标 | 符号 | 公式 | 范围 | 说明 |
|------|------|------|------|------|
| 淘汰翻转率 | $\text{EFR}$ | $\frac{\#(\text{方法不同结果})}{\text{总周数}}$ | [0, 1] | 两种方法导致不同淘汰的比例 |
| 排名变化率 | $\text{RCR}$ | $\frac{\sum |R_i^{\text{rank}} - R_i^{\text{pct}}|}{n \times W}$ | [0, n-1] | 平均每位选手排名变化 |
| 排名相关系数 | $\tau$ | Kendall's τ | [-1, 1] | 两种排名的相关性 |
| 有效评委权重 | $\alpha$ | 权重分解公式 | [0, 1] | 评委分数的实际贡献 |

### 4.2 敏感性指标

| 指标 | 符号 | 公式 | 说明 |
|------|------|------|------|
| 边界敏感度 | $\text{MS}$ | 边际影响的方差 | 方法对小变化的敏感程度 |
| 淘汰边距 | $\Delta$ | 第2低 - 第1低 | 淘汰决定的确信度 |
| 逆转阈值 | $\theta$ | 使淘汰者改变所需的最小投票变化 | 稳定性度量 |

### 4.3 公平性指标

| 指标 | 说明 | 计算方法 |
|------|------|----------|
| 评委偏向度 | 方法对高评委分选手的保护程度 | 相关分析 |
| 观众声音 | 观众投票对结果的实际影响 | 权重分解 |
| 极端值抗性 | 对极端分数的鲁棒性 | 模拟分析 |

---

## 5. 代码模块

### 5.1 模块概览

```
scripts/
├── task2_scoring_methods.py     # 脚本1：核心计算 + 反事实模拟
├── task2_comparison_analysis.py # 脚本2：比较分析 + 统计指标
└── task2_weight_decomposition.py # 脚本3：权重分解 + 边际影响
```

### 5.2 脚本1: task2_scoring_methods.py

**职责**：计分方法核心函数库 + 反事实模拟

**核心函数**：

```python
def compute_ranking_method(judge_scores: np.ndarray, votes: np.ndarray) -> tuple:
    """
    排名法计算
    返回: (combined_ranks, eliminated_idx)
    """

def compute_percentage_method(judge_scores: np.ndarray, votes: np.ndarray) -> tuple:
    """
    百分比法计算
    返回: (combined_percentages, eliminated_idx)
    """

def run_counterfactual(data_path: str, vote_estimates_path: str) -> pd.DataFrame:
    """
    反事实模拟主函数
    对每个季/周，用两种方法计算结果，比较差异
    """
```

**输出文件**：`task2_counterfactual.csv`

| 列名 | 类型 | 说明 |
|------|------|------|
| season | int | 赛季 |
| week | int | 周次 |
| n_contestants | int | 参赛人数 |
| actual_method | str | 实际使用的方法 |
| actual_eliminated | str | 实际淘汰者 |
| cf_eliminated | str | 反事实淘汰者 |
| elimination_flipped | bool | 淘汰是否翻转 |
| rank_tau | float | 排名相关系数 |
| rank_rho | float | Spearman相关 |

### 5.3 脚本2: task2_comparison_analysis.py

**职责**：比较分析 + 统计指标

**核心函数**：

```python
def compute_flip_rates(cf_df: pd.DataFrame) -> dict:
    """
    计算淘汰翻转率和排名变化率
    按季节、方法类型、整体汇总
    """

def compute_correlation_stats(cf_df: pd.DataFrame) -> dict:
    """
    计算 Kendall's τ 和 Spearman's ρ 统计
    """

def generate_summary_report(cf_df: pd.DataFrame) -> pd.DataFrame:
    """
    生成汇总报告
    """
```

**输出文件**：`task2_comparison_stats.csv`

| 列名 | 类型 | 说明 |
|------|------|------|
| group | str | 分组（overall / season_X） |
| n_weeks | int | 周数 |
| elimination_flip_rate | float | 淘汰翻转率 |
| mean_rank_tau | float | 平均 Kendall's τ |
| mean_rank_rho | float | 平均 Spearman's ρ |
| flip_count | int | 翻转次数 |

### 5.4 脚本3: task2_weight_decomposition.py

**职责**：权重分解 + 边际影响分析

**核心函数**：

```python
def compute_effective_weights(judge_scores: np.ndarray, votes: np.ndarray, method: str) -> float:
    """
    计算给定方法下评委的有效权重
    """

def compute_marginal_impact(judge_scores: np.ndarray, votes: np.ndarray, method: str) -> np.ndarray:
    """
    计算投票变化的边际影响
    """

def run_weight_analysis(data_path: str, vote_estimates_path: str) -> pd.DataFrame:
    """
    权重分解主函数
    """
```

**输出文件**：`task2_weight_analysis.csv`

| 列名 | 类型 | 说明 |
|------|------|------|
| season | int | 赛季 |
| week | int | 周次 |
| judge_weight_rank | float | 排名法下评委权重 |
| judge_weight_pct | float | 百分比法下评委权重 |
| vote_marginal_rank | float | 排名法下投票边际影响 |
| vote_marginal_pct | float | 百分比法下投票边际影响 |
| weight_difference | float | 权重差异 |

---

## 6. 结果

### 6.1 整体统计

| 指标 | 值 | 说明 |
|------|-----|------|
| 总分析周数 | 301 | 覆盖 Season 1-34 |
| 淘汰翻转率 (EFR) | 21.9% | 66次翻转 |
| 平均 Kendall's τ | 0.828 | 高度一致 |
| 平均 Spearman's ρ | 0.897 | 高度一致 |

### 6.2 按计分方法分组

| 实际方法 | 周数 | 翻转率 | 平均 τ | 平均 ρ |
|----------|------|--------|--------|--------|
| 排名法 (S1-2, 28-34) | 74 | 0.0% | 0.703 | 0.785 |
| 百分比法 (S3-27) | 227 | 29.1% | 0.868 | 0.934 |

**关键发现**：排名法时期翻转率为0，百分比法时期约29%的周会因方法不同而产生不同淘汰结果。

### 6.3 权重分析结果

| 方法 | 评委有效权重 | 观众有效权重 | 观众权重>50%占比 |
|------|--------------|--------------|------------------|
| 排名法 | 48.2% | 51.8% | ~50% (固定) |
| 百分比法 | 22.9% | 77.1% | 93.4% |

**关键发现**：百分比法下观众有效权重平均达到77.1%，远高于排名法的51.8%。

### 6.4 翻盘率分析 (Upset Rate)

翻盘定义：评委最低分者未被淘汰的比例

| 方法 | 翻盘次数 | 总周数 | 翻盘率 |
|------|----------|--------|--------|
| 排名法 | 48 | 74 | 64.9% |
| 百分比法 | 124 | 227 | 54.6% |

**注意**：翻盘率高并不等于"更偏向观众"。排名法翻盘率更高是因为其离散性质——评委分数差距再大也只贡献1个名次差。

### 6.5 偏向性分析：哪种方法更偏向观众？

#### 核心指标对比

| 指标 | 排名法 | 百分比法 | 偏向观众的方法 |
|------|--------|----------|----------------|
| 观众有效权重 | 51.8% | 77.1% | **百分比法** |
| 翻盘率 | 64.9% | 54.6% | 排名法 (但需谨慎解读) |

#### 结论

**百分比法更偏向观众**，理由如下：

1. **有效权重证据**：百分比法下观众有效权重平均77.1%，93.4%的周次中观众权重超过50%。这意味着在百分比法下，投票差异对淘汰结果的影响远大于评委分数差异。

2. **翻盘率的正确解读**：虽然排名法翻盘率更高(64.9% vs 54.6%)，但这反映的是方法的"结构性质"而非"偏向性"：
   - 排名法将分数转换为离散排名，抹去了分数差距信息
   - 即使评委分最低的选手分数远低于其他人，其排名也只多1位
   - 这使得高投票更容易"救"评委分最低的选手

3. **因果机制**：百分比法的高观众权重意味着"投票决定淘汰"，而排名法的高翻盘率是因为"分数差距被压缩"。两者虽然表面相似，但机制不同。

### 6.6 关键发现总结

1. **两种方法在78%的情况下产生相同淘汰结果**：淘汰翻转率21.9%，排名相关系数τ=0.828。

2. **百分比法更偏向观众**：观众有效权重77.1% vs 51.8%。当评委评分一致时，投票几乎完全决定淘汰。

3. **排名法更稳定/可预测**：翻转率0%（对比百分比法29.1%），固定50-50权重。

4. **百分比法权重动态变化**：取决于分数分布，范围36%-99%。当评委评分分散时偏向评委，评分一致时偏向观众。

5. **争议多发于百分比法时期**：Bobby Bones (S27) 等争议案例都发生在百分比法时期，因为该方法允许高投票覆盖低评委分。

---

## 7. 假设验证

### 假设1：排名法更稳定 ✓

**验证结果**：排名法翻转率0%，百分比法29.1%。排名法的离散性质使其对投票波动不敏感。

### 假设2：百分比法更敏感 ✓

**验证结果**：百分比法边际影响约0.92（连续响应），排名法边际影响为0或阶跃。

### 假设3：评委分数离散时百分比法评委权重更大 ✓

**验证结果**：百分比法权重范围36%-99%，当评委分数方差大时评委权重上升。

### 假设4：两种方法在大多数情况下一致 ✓

**验证结果**：78%的周两种方法结果一致，但百分比法时期29%的周会产生不同结果。

---

## 8. 附录

### 8.1 数据来源

- **评委分数**：`2026_MCM-ICM_Problems/2026_MCM_Problem_C_Data.csv`
- **投票估计**：`scripts/task1_vote_estimates.csv`（Task 1 输出）

### 8.2 符号表

| 符号 | 含义 |
|------|------|
| $n$ | 当周参赛选手数 |
| $S_i$ | 选手 $i$ 的评委总分 |
| $V_i$ | 选手 $i$ 的投票份额（已归一化） |
| $R_i^{(S)}$ | 选手 $i$ 的评委分数排名 |
| $R_i^{(V)}$ | 选手 $i$ 的投票排名 |
| $P_i^{(S)}$ | 选手 $i$ 的评委分数百分比 |
| $P_i^{(V)}$ | 选手 $i$ 的投票百分比 |
| $C_i^{\text{rank}}$ | 排名法综合得分 |
| $C_i^{\text{pct}}$ | 百分比法综合得分 |
| $\alpha$ | 评委有效权重 |
| $\tau$ | Kendall 相关系数 |
| $\rho$ | Spearman 相关系数 |
| EFR | 淘汰翻转率 (Elimination Flip Rate) |
| RCR | 排名变化率 (Rank Change Rate) |

### 8.3 参考文献

- MCM 2026 Problem C 题目说明
- Dancing with the Stars 官方规则

---

*文档版本：v2.0*
*创建时间：2026-01-30*
*更新时间：2026-01-31*
*状态：分析完成*
